<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">


    <h:body>

        <ui:composition template="./../../templates/plantilla.xhtml">
            <ui:define name="content">
                <f:event listener="#{empleadoC.listarAll()}" type="preRenderView" />


                <h:form id="formEncabezado">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="Nuevo" icon="pi pi-plus" 
                                             update=":formNuevoEmpleado" oncomplete="PF('dialogNuevoEmpleado').show()"
                                             styleClass="ui-button-success" style="margin-right: .5rem"
                                             actionListener="#{empleadoC.limpiar()}">
                                <p:resetInput target=":formNuevoEmpleado"/>
                            </p:commandButton>
                        </p:toolbarGroup>

                        <p:toolbarGroup align="center">
                            <div class="empleado-table-header">
                                <span style="font-weight: bold">EMPLEADOS</span>
                            </div>
                        </p:toolbarGroup>

                        <p:toolbarGroup align="right">
                            <p:commandButton value=" XLS " icon="pi pi-download" styleClass="ui-button-help" ajax="false"
                                             style="float:right; background-color: yellowgreen; margin-right:10px">
                                <p:dataExporter type="xls" target=":formMostrarEmpleado:tablaEmpleado" fileName="Empleado"/>
                            </p:commandButton>

                            <p:commandButton value="Reporte" styleClass="" ajax="false"
                                             style="float:right; background-color: #90CAF9" actionListener="#{empleadoC.reporteEmpleado()}"
                                             onclick="this.form.target = '_blank'" title="Relacion de Empleados "
                                             icon="pi pi-download"/>
                        </p:toolbarGroup>
                    </p:toolbar>
                </h:form>



                
                
                <h:form id="formMostrarEmpleado">
                    <p:dataTable id="tablaEmpleado" widgetVar="dtEmpleado" var="empleado" value="#{empleadoC.listaEmpleado}"
                                 reflow="true" styleClass="empleado-table"  rowKey="#{empleado.IDEMP}"
                                 paginator="true" rows="10"  selectionMode="single" 
                                  paginatorPosition="bottom" selection="#{empleadoC.empleado}"
                                 emptyMessage="No hay datos de empleado">

                        <f:facet name="header">
                            <div class="products-table-header2">
                                <p:selectOneMenu value="#{empleadoC.cass}" styleClass="estado">
                                    <f:selectItem noSelectionOption="true" itemLabel="Todos" itemValue="3"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Activos" itemValue="1"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Inactivos" itemValue="2">
                                    </f:selectItem>
                                    <p:ajax listener="#{empleadoC.listar()}" update="formMostrarEmpleado"/>
                                </p:selectOneMenu>
                            </div>
                        </f:facet>

                        <p:column headerText="Codigo" sortBy="#{empleado.IDEMP}" >
                            <h:outputText value="#{empleado.IDEMP}"/>
                        </p:column>
                        <p:column headerText="Nombre" filterBy="#{empleado.NOMEMP}">
                            <h:outputText value="#{empleado.NOMEMP}"/>
                        </p:column>
                        <p:column headerText="Apellido" filterBy="#{empleado.APEEMP}">
                            <h:outputText value="#{empleado.APEEMP}"/>
                        </p:column>
                        <p:column headerText="DNI" filterBy="#{empleado.DNIEMP}">
                            <h:outputText value="#{empleado.DNIEMP}"/>
                        </p:column>
                        <p:column headerText="Celular" filterBy="#{empleado.CELEMP}">
                            <h:outputText value="#{empleado.CELEMP}"/>
                        </p:column>
                        <p:column headerText="Correo" sortBy="#{empleado.COREMP}">
                            <h:outputText value="#{empleado.COREMP}"/>
                        </p:column>
                        <p:column headerText="Cargo" sortBy="#{empleado}">
                            <h:outputText value="#{empleado.NOMCAR}"/>
                        </p:column>

                        <p:column exportable="false">
                            <p:commandButton icon="pi pi-pencil" update=":formEditarEmpleado"
                                             oncomplete="PF('dialogModificarEmpleado').show()"
                                             styleClass="edit-button rounded-button ui-button-success">
                                <f:setPropertyActionListener value="#{empleado}" target="#{empleadoC.empleado}"/>
                                <p:resetInput target=":formEditarEmpleado"/>
                            </p:commandButton>

                            <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" 
                                             oncomplete="PF('deleteEmpleadoDialog').show()"
                                             update=":formMostrarEmpleado">
                                <f:setPropertyActionListener value="#{empleado}" target="#{empleadoC.empleado}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                    
                    
                    <p:contextMenu for="tablaEmpleado" id="contextPrueba">
                        <p:menuitem value="Editar" oncomplete="PF('dialogModificarEmpleado').show()"
                                    icon="pi pi-save" update=":formEditarEmpleado"
                                    rendered="#{!empleadoC.estadoInactivo}">
                            <p:resetInput target=":formEditarEmpleado"/>
                        </p:menuitem>

                        <p:menuitem value="Eliminar" icon="pi pi-refresh" 
                                    oncomplete="PF('deleteEmpleadoDialog').show()"
                                    update=":formMostrarEmpleado:tablaEmpleado"
                                    rendered="#{!empleadoC.estadoInactivo}">
                        </p:menuitem>

                        <p:menuitem value="Restaurar" icon="=pi pi-search" actionListener="#{empleadoC.restaurarEmpleado()}"
                                    update="formMostrarEmpleado:tablaEmpleado" rendered="#{empleadoC.estadoInactivo}">
                            <p:confirm header="Confirmación" message="¿Deseas restaurar?" icon="pi pi-search"/>
                        </p:menuitem>
                    </p:contextMenu>

                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </p:confirmDialog>
                    
                </h:form>
                
                
                
                
                
                <p:dialog id="dlgEditEmpleado" header="Empleado Detalles" showEffect="fade" modal="true"
                          widgetVar="dialogModificarEmpleado" responsive="true" >
                    <h:form id="formEditarEmpleado">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombre" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{empleadoC.empleado.NOMEMP}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgNOMEMP" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Ingrese el Nombre" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMEMP" for="nombre"/>

                            <p:outputLabel value ="Apellido" style="font-weight:bold; font-size:16px" />
                            <p:inputText value="#{empleadoC.empleado.APEEMP}" required="true" id="apellido">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgAPECLI" event="keyup" delay="800"/>
                                <p:tooltip for="apellido" value="Ingrese el Apellido" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgAPECLI" for="apellido"/>
                            
                            <p:outputLabel for="DNIEMP">DNI</p:outputLabel>
                            <p:inputText value ="#{empleadoC.empleado.DNIEMP}" required="true" id="DNIEMP" maxlength="8">
                                <f:validateLength minimum="" maximum="8"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="dniV"/>
                                <f:attribute name="ids" value="#{empleadoC.empleado.IDEMP}" />
                                <f:attribute name="tipo" value="EMPLEADO" />
                                <p:ajax update="msgDNIEMP" event="keyup" delay="800"/>
                                <p:tooltip for="DNIEMP" value="Ingrese el DNI" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgDNIEMP" for="DNIEMP"/>  

                            <p:outputLabel value ="celular" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{empleadoC.empleado.CELEMP}" required="true" id="celular" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="celularV"/>
                                <f:attribute name="telefono" value="#{empleadoC.empleado.CELEMP}" />
                                <p:ajax update="msgTELEMP" event="keyup" delay="800"/>
                                <p:tooltip for="celular" value="Ingrese el TELEFONO" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgTELEMP" for="celular"/>

                            <p:outputLabel value ="correo" style="font-weight:bold; font-size:16px" />
                            <p:inputText id="EMAEMP" value="#{empleadoC.empleado.COREMP}" maxlength="50">
                                <f:validator validatorId="emailV"/>
                                <f:attribute name="ids" value="#{empleadoC.empleado.IDEMP}" />
                                <f:attribute name="tipo" value="EMPLEADO" />
                                <p:ajax update="msgEMAEMP" event="keyup" delay="800"/>
                                <p:tooltip for="EMAEMP" value="Ingrese el EMAIL" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgEMAEMP" for="EMAEMP"/> 
                            
                            <p:outputLabel for="Cargo">Cargo: </p:outputLabel>              
                            <p:selectOneMenu id="Cargo" value="#{empleadoC.cargoSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{empleadoC.empleado.NOMCAR}" itemDisabled="true" />
                                <f:selectItems value="#{empleadoC.listCargo}"/>
                                <f:ajax execute="proveedor" render="#{empleadoC.cargoSelect}" />
                            </p:selectOneMenu> 

                            <p:outputLabel for="Ubigeo">Ubigeo:  </p:outputLabel>              
                            <p:selectOneMenu id="Ubigeo" value="#{empleadoC.ubigeoSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{empleadoC.empleado.NOMCAR}" itemDisabled="true" />
                                <f:selectItems value="#{empleadoC.listUbigeo}"/>
                                <f:ajax execute="proveedor" render="#{empleadoC.ubigeoSelect}" />
                            </p:selectOneMenu> 


                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{empleadoC.modificarEmpleado()}"
                                             update=":formMostrarEmpleado:tablaEmpleado" 
                                             id="btnModificar"  value="Modificar"
                                             oncomplete="if(!args.validationFailed)PF('dialogModificarEmpleado').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogModificarEmpleado').hide()"
                                             class="ui-button-secondary"/>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>

                
                
                

                <p:dialog id="dlgNuevoEmpleado" header="Nuevo Empleado" showEffect="fade" modal="true"
                          widgetVar="dialogNuevoEmpleado" responsive="true" >
                    <h:form id="formNuevoEmpleado">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombre" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{empleadoC.empleado.NOMEMP}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgNOMEMP" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Ingrese el Nombre" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMEMP" for="nombre"/>

                            <p:outputLabel value ="Apellido" style="font-weight:bold; font-size:16px" />
                            <p:inputText value="#{empleadoC.empleado.APEEMP}" required="true" id="apellido">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgAPECLI" event="keyup" delay="800"/>
                                <p:tooltip for="apellido" value="Ingrese el Apellido" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgAPECLI" for="apellido"/>

                            <p:outputLabel for="DNIEMP">DNI</p:outputLabel>
                            <p:inputText value ="#{empleadoC.empleado.DNIEMP}" required="true" id="DNIEMP" maxlength="8">
                                <f:validateLength minimum="" maximum="8"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="dniV"/>
                                <f:attribute name="ids" value="#{empleadoC.empleado.IDEMP}" />
                                <f:attribute name="tipo" value="EMPLEADO" />
                                <p:ajax update="msgDNIEMP" event="keyup" delay="800"/>
                                <p:tooltip for="DNIEMP" value="Ingrese el DNI" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgDNIEMP" for="DNIEMP"/>  

                            <p:outputLabel value ="celular" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{empleadoC.empleado.CELEMP}" required="true" id="celular" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="celularV"/>
                                <f:attribute name="telefono" value="#{empleadoC.empleado.CELEMP}" />
                                <p:ajax update="msgTELEMP" event="keyup" delay="800"/>
                                <p:tooltip for="celular" value="Ingrese el TELEFONO" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgTELEMP" for="celular"/>

                            <p:outputLabel value ="correo" style="font-weight:bold; font-size:16px" />
                            <p:inputText id="EMAEMP" value="#{empleadoC.empleado.COREMP}" maxlength="50">
                                <f:validator validatorId="emailV"/>
                                <f:attribute name="ids" value="#{empleadoC.empleado.IDEMP}" />
                                <f:attribute name="tipo" value="EMPLEADO" />
                                <p:ajax update="msgEMAEMP" event="keyup" delay="800"/>
                                <p:tooltip for="EMAEMP" value="Ingrese el EMAIL" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgEMAEMP" for="EMAEMP"/> 

                            <p:outputLabel for="Cargo">Cargo: </p:outputLabel>              
                            <p:selectOneMenu id="Cargo" value="#{empleadoC.cargoSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{empleadoC.empleado.NOMCAR}" itemDisabled="true" />
                                <f:selectItems value="#{empleadoC.listCargo}"/>
                                <f:ajax execute="proveedor" render="#{empleadoC.cargoSelect}" />
                            </p:selectOneMenu> 

                            <p:outputLabel for="Ubigeo">Ubigeo:  </p:outputLabel>              
                            <p:selectOneMenu id="Ubigeo" value="#{empleadoC.ubigeoSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{empleadoC.empleado.NOMCAR}" itemDisabled="true" />
                                <f:selectItems value="#{empleadoC.listUbigeo}"/>
                                <f:ajax execute="proveedor" render="#{empleadoC.ubigeoSelect}" />
                            </p:selectOneMenu> 


                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{empleadoC.nuevoEmpleado()}"
                                             update=":formMostrarEmpleado:tablaEmpleado" 
                                             id="btnModificar"  value="Modificar"
                                             oncomplete="if(!args.validationFailed)PF('dialogNuevoEmpleado').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogNuevoEmpleado').hide()"
                                             class="ui-button-secondary"/>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>




                
                <p:confirmDialog widgetVar="deleteEmpleadoDialog" showEffect="fade" width="300"
                                 message="Delete the product?" header="Confirm" severity="warn">
                    <p:commandButton value="Yes" icon="pi pi-check" actionListener="#{empleadoC.eliminarEmpleado()}"
                                     process="@this" oncomplete="PF('deleteEmpleadoDialog').hide()" 
                                     update=":formMostrarEmpleado:tablaEmpleado"/>
                    <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                                     onclick="PF('deleteEmpleadoDialog').hide()" 
                                     update=":formMostrarEmpleado:tablaEmpleado"/>
                </p:confirmDialog>




            </ui:define>
        </ui:composition>

    </h:body>
</html>
