<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">


    <h:body>

        <ui:composition template="./../../templates/plantilla.xhtml">
            <ui:define name="content">
                <f:event listener="#{productoC.listar()}" type="preRenderView" />


                <h:form id="formEncabezado">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="Nuevo" icon="pi pi-plus"
                                             update=":formNuevoProducto" oncomplete="PF('dialogNuevoProducto').show()"
                                             styleClass="ui-button-success" style="margin-right: .5rem"
                                             actionListener="#{productoC.limpiar()}" >
                                <p:resetInput target=":formNuevoProducto"/>
                            </p:commandButton>
                        </p:toolbarGroup>
                        
                        <p:toolbarGroup align="center">
                            <div class="products-table-header">
                                <span style="font-weight: bold">PRODUCTOS</span>
                            </div>
                        </p:toolbarGroup>

                        <p:toolbarGroup align="right">
                            <p:commandButton value=" XLS " icon="pi pi-download" styleClass="ui-button-help" ajax="false"
                                             style="float:right; background-color: yellowgreen; margin-right:10px">
                                <p:dataExporter type="xls" target=":formMostrarProducto:tablaProducto" fileName="productos"/>
                            </p:commandButton>
                            <p:commandButton value="Reporte" styleClass="" ajax="false"
                                             style="float:right; background-color: #90CAF9" actionListener="#{productoC.reporteProducto()}"
                                             onclick="this.form.target = '_blank'" title="Relacion de Productos "
                                             icon="pi pi-download"/>
                        </p:toolbarGroup>
                    </p:toolbar>
                </h:form>



                
                
                <h:form id="formMostrarProducto">
                    <p:dataTable id="tablaProducto" widgetVar="dtProducto" var="producto" value="#{productoC.listaProducto}"
                                 reflow="true" styleClass="products-table" rowKey="#{producto.ID}"
                                 paginator="true" rows="10" selectionMode="single"
                                 paginatorPosition="bottom" selection="#{productoC.producto}"
                                 emptyMessage="No hay datos de cliente">

                        <f:facet name="header">
                            <div class="products-table-header2">
                                <p:selectOneMenu value="#{productoC.cass}" styleClass="estado">
                                    <f:selectItem noSelectionOption="true" itemLabel="Todos" itemValue="3"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Activos" itemValue="1"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Inactivos" itemValue="2">
                                    </f:selectItem>
                                    <p:ajax listener="#{productoC.listar()}" update="formMostrarProducto"/>
                                </p:selectOneMenu>
                            </div>
                        </f:facet>

                        <p:column headerText="Codigo" sortBy="#{producto.ID}" >
                            <h:outputText value="#{producto.ID}"/>
                        </p:column>
                        <p:column headerText="Nombre" filterBy="#{producto.NOMPROD}">
                            <h:outputText value="#{producto.NOMPROD}"/>
                        </p:column>
                        <p:column headerText="Stock" filterBy="#{producto.CANPRO}">
                            <h:outputText value="#{producto.CANPRO}"/>
                        </p:column>
                        <p:column headerText="Categoria" filterBy="#{producto.CATPRO}">
                            <h:outputText value="#{producto.CATPRO}"/>
                        </p:column>
                        <p:column headerText="Precio" sortBy="#{producto.PRECPRO}">
                            <h:outputText value="#{producto.PRECPRO}"/>
                        </p:column>

                        <p:column exportable="false">
                            <p:commandButton icon="pi pi-pencil" update=":formEditarProducto"
                                             oncomplete="PF('dialogModificarProducto').show()"
                                             styleClass="edit-button rounded-button ui-button-success">
                                <f:setPropertyActionListener value="#{producto}" target="#{productoC.producto}"/>
                                <p:resetInput target=":formEditarProducto"/>
                            </p:commandButton>

                            <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" 
                                             oncomplete="PF('deleteProductDialog').show()"
                                             update=":formMostrarProducto:tablaProducto">
                                <f:setPropertyActionListener value="#{producto}" target="#{productoC.producto}"/>
                            </p:commandButton>        
                        </p:column>

                    </p:dataTable>
                    
                    
                    <p:contextMenu for="tablaProducto" id="contextPrueba">
                        <p:menuitem value="Editar" oncomplete="PF('dialogModificarProducto').show()"
                                    icon="pi pi-save" update=":formEditarProducto"
                                    rendered="#{!productoC.estadoInactivo}">
                            <p:resetInput target=":formEditarProducto"/>
                        </p:menuitem>

                        <p:menuitem value="Eliminar" icon="pi pi-refresh" 
                                    oncomplete="PF('deleteProductDialog').show()"
                                    update=":formMostrarProducto:tablaProducto"
                                    rendered="#{!productoC.estadoInactivo}">
                        </p:menuitem>

                        <p:menuitem value="Restaurar" icon="=pi pi-search" actionListener="#{productoC.restaurarProducto()}"
                                    update=":formMostrarProducto:tablaProducto" rendered="#{productoC.estadoInactivo}">
                            <p:confirm header="Confirmación" message="¿Deseas restaurar?" icon="pi pi-search"/>
                        </p:menuitem>
                    </p:contextMenu>

                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </p:confirmDialog>
                    
                </h:form>
                
                
                
                
                      
                <p:dialog id="dlgEditProducto" header="Producto Detalles" showEffect="fade" modal="true"
                          widgetVar="dialogModificarProducto" responsive="true" >
                    <h:form id="formEditarProducto">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombres" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.NOMPROD}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <f:validator validatorId="prodV"/>
                                <p:ajax update="msgNOMCLI" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Nombre del Producto" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMCLI" for="nombre"/>

                            <p:outputLabel value ="Stock" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.CANPRO}" required="true" id="stock" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <p:ajax update="msgSTOCK" event="keyup" delay="800"/>
                                <p:tooltip for="stock" value="Ingrese el Stock" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgSTOCK" for="stock"/>

                            <p:outputLabel value ="categoria" style="font-weight:bold; font-size:16px" />
                            <p:selectOneMenu id="categoria" value="#{productoC.categSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{productoC.producto.NOMPROD}" itemDisabled="true" />
                                <f:selectItems value="#{productoC.listCate}"/>
                                <f:ajax execute="proveedor" render="#{productoC.categSelect}" />
                                <p:ajax update="msgCAT" event="keyup" delay="800"/>
                            </p:selectOneMenu> 
                            <p:tooltip for="categoria" value="Elija la Categoria" trackMouse="focus"/>
                            <p:message id="msgCAT" for="categoria"/>

                            <p:outputLabel value ="precio" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.PRECPRO}" required="true" id="precio" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                            </p:inputText>

                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{productoC.modificarProducto()}"
                                             update=":formMostrarProducto:tablaProducto" 
                                             id="btnModificar"  value="Modificar"
                                             oncomplete="if(!args.validationFailed)PF('dialogModificarProducto').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogModificarProducto').hide()"
                                             class="ui-button-secondary"/>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>




                
                <p:dialog id="dlgNuevoProducto" header="Nuevo Producto" showEffect="fade" modal="true"
                          widgetVar="dialogNuevoProducto" responsive="true" >
                    <h:form id="formNuevoProducto">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombres" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.NOMPROD}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <f:validator validatorId="prodV"/>
                                <p:ajax update="msgNOMCLI" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Nombre del Producto" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMCLI" for="nombre"/>

                            <p:outputLabel value ="Stock" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.CANPRO}" required="true" id="stock" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <p:ajax update="msgSTOCK" event="keyup" delay="800"/>
                                <p:tooltip for="stock" value="Ingrese el Stock" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgSTOCK" for="stock"/>

                            <p:outputLabel value ="categoria" style="font-weight:bold; font-size:16px" />
                            <p:selectOneMenu id="categoria" value="#{productoC.categSelect}" style="width:15rem">
                                <f:selectItem itemLabel="#{productoC.producto.NOMPROD}" itemDisabled="true" />
                                <f:selectItems value="#{productoC.listCate}"/>
                                <f:ajax execute="proveedor" render="#{productoC.categSelect}" />
                                <p:ajax update="msgCAT" event="keyup" delay="800"/>
                            </p:selectOneMenu> 
                            <p:tooltip for="categoria" value="Elija la Categoria" trackMouse="focus"/>
                            <p:message id="msgCAT" for="categoria"/>

                            <p:outputLabel value ="precio" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{productoC.producto.PRECPRO}" required="true" id="precio" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                            </p:inputText>

                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{productoC.nuevoProducto()}"
                                             update=":formMostrarProducto:tablaProducto" 
                                             id="btnModificar"  value="Modificar"
                                             oncomplete="if(!args.validationFailed)PF('dialogNuevoProducto').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogNuevoProducto').hide()"
                                             class="ui-button-secondary"/>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>
                
                
                
                
                
                <p:confirmDialog widgetVar="deleteProductDialog" showEffect="fade" width="300"
                                 message="Delete the product?" header="Confirm" severity="warn">
                    <p:commandButton value="Yes" icon="pi pi-check" actionListener="#{productoC.eliminarProducto()}"
                                     process="@this" oncomplete="PF('deleteProductDialog').hide()" 
                                     update=":formMostrarProducto:tablaProducto"/>
                    <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                                     onclick="PF('deleteProductDialog').hide()" 
                                     update=":formMostrarProducto:tablaProducto"/>
                </p:confirmDialog>





            </ui:define>
        </ui:composition>

    </h:body>
</html>
