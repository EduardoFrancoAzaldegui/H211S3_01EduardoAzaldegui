<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>



        <ui:composition template="./../../templates/plantilla.xhtml">
            <ui:define name="content">
                <ui:param name="carrito" value="#{carritoVentaC}" />

                <center>
                    <h:form style="background-color:#ffffff">
                        <p:panelGrid  style="border:none;margin-top:3% " styleClass="companyHeaderGrid">
                            <p:row>
                                <p:column>
                                    <p:outputLabel for="@next" value="Sucursal" style='padding-right:20px'/>
                                    <p:selectOneMenu id="sucursal" value="#{carrito.sucursalSelect}" style="width:15rem">
                                        <f:selectItem itemLabel="Selecciona un sucursal" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{carrito.listSucursal}"/>
                                        <p:ajax listener="#{carrito.ActualizarCampos()}" 
                                                update="despachador vendedor producto"/>
                                    </p:selectOneMenu>
                                </p:column>


                                <p:column>
                                    <p:outputLabel for="@next" value="Producto" style='padding-right:20px'/>
                                    <p:selectOneMenu id="producto" value="#{carrito.productoSelect}" style="width:15rem">
                                        <f:selectItem itemLabel="Selecciona un producto" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{carrito.listProducto}"/>
                                        <f:ajax execute="producto" render="#{carrito.setProductoSelect(productoSelect)}"/>
                                        <p:ajax event="valueChange" listener="#{carrito.updateMaxSpinner()}" update="rotate"
                                                 />
                                    </p:selectOneMenu>
                                </p:column>
                            </p:row>


                            <p:row>                             
                                <p:column>
                                    <div class="p-field p-col-12 p-md-4">
                                        <p:outputLabel for="@next" value="Cantidad " style='padding-right:20px'/>
                                        <p:spinner id="rotate" value="#{carrito.cantidadSelect}" min="1" max="#{carrito.maxSpinner}" rotate="true"/>
                                    </div> 
                                </p:column>
                                
                                <p:column>
                                    <p:outputLabel for="@next" value="Cliente" style='padding-right:20px'/>
                                    <p:selectOneMenu id="cliente" value="#{carrito.clienteSelect}" style="width:15rem">
                                        <f:selectItem itemLabel="Selecciona al Cliente" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{carrito.listCliente}"/>
                                        <f:ajax execute="cliente" render="#{carrito.setClienteSelect(clienteSelect)}" />
                                    </p:selectOneMenu>
                                </p:column>
                             </p:row>

                            
                            <p:row>
                                <p:column>
                                    <p:outputLabel for="@next" value="Vendedor" style='padding-right:20px'/>
                                    <p:selectOneMenu id="vendedor" value="#{carrito.vendedorSelect}" style="width:15rem">
                                        <f:selectItem itemLabel="Selecciona un Vendedor" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{carrito.listVendedor}"/>
                                        <f:ajax execute="vendedor" render="#{carrito.setVendedorSelect(VendedorSelect)}"/>
                                    </p:selectOneMenu>
                                </p:column>

                                <p:column>
                                    <p:outputLabel for="@next" value="Despachador" style='padding-right:20px'/>
                                    <p:selectOneMenu id="despachador" value="#{carrito.despachadorSelect}" style="width:15rem">
                                        <f:selectItem itemLabel="Selecciona un Despachador" itemValue="#{null}" noSelectionOption="true"/>
                                        <f:selectItems value="#{carrito.listDespachador}"/>
                                        <f:ajax execute="despachador" render="#{carrito.setDespachadorSelect(DespachadorSelect)}"/>
                                    </p:selectOneMenu>
                                </p:column>

                            </p:row>
                            
                            
                            <p:row>
                                <p:column>
                                    <p:commandButton  value="+ Agregar Articulo" styleClass="ui-button-info"
                                                      actionListener="#{carrito.agregarItem()}"
                                                      update=":formMostrarCarrito:tablaCarrito" />
                                </p:column>

                                <p:column>

                                </p:column>

                            </p:row>
                        </p:panelGrid>
                    </h:form>
                </center>


                <h:form id="formMostrarCarrito" style="border:none;margin-top:3%;margin-bottom:4% ;margin-left:2%;margin-right: 2%" >
                    <p:growl id="messages" showDetail="false" rendered="false"/>

                    <p:dataTable id="tablaCarrito" widgetVar="dtCarrito" var="carritos" value="#{carrito.listaVenta}"
                                 reflow="true" styleClass="products-table"  
                                 paginator="true" 
                                 rows="5" rowSelectMode="add" paginatorPosition="bottom"
                                 emptyMessage="No hay datos de los Items">

                        <f:facet name="header">
                            <div class="products-table-header">
                                <span style="font-weight: bold">Productos</span>

                                <span class="filter-container ui-input-icon-left">
                                    <i class="pi pi-search"></i>
                                    <p:inputText id="globalFilter" onkeyup="PF('dtCarrito').filter()" placeholder="Buscar..."/>
                                </span>
                            </div>
                        </f:facet>

                        <p:column headerText="Producto" sortBy="#{carritos.NOMPRO}">
                            <h:outputText value="#{carritos.NOMPRO}"/>
                        </p:column>
                        <p:column headerText="Precio" sortBy="#{carritos.PREPRO}">
                            <h:outputText value="#{carritos.PREPRO}"/>
                        </p:column>
                        <p:column headerText="Cantidad" sortBy="#{carritos.CANTVEDET}">
                            <h:outputText value="#{carritos.CANTVEDET}"/>
                        </p:column>
                        <p:column headerText="Subtotal" sortBy="#{carritos.SUBTOTAL}">
                            <h:outputText value="#{carritos.SUBTOTAL}"/>
                        </p:column>

                        <f:facet name="footer" >
                            <span class="p-text-bold" style="padding-right:10px;float:right;margin-top: 10px" >Total : #{carrito.TOTAL}</span>

                            <p:commandButton  value="Comprar" styleClass="ui-button-success" 
                                              actionListener="#{carrito.comprarItems()}"
                                              style="margin-right:20px"
                                              update=":formMostrarCarrito:tablaCarrito" />

                            <p:commandButton  value="Cancelar" styleClass="ui-button-danger" 
                                              actionListener="#{carrito.eliminarItems()}"
                                              update=":formMostrarCarrito:tablaCarrito" />
                        </f:facet>

                    </p:dataTable>               
                </h:form>





            </ui:define>
        </ui:composition>
    </h:body>
</html>

