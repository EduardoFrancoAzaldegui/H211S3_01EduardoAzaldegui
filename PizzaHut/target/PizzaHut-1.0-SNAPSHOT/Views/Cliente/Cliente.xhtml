<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">


    <h:body>
        <ui:composition template="./../../templates/plantilla.xhtml">
            <ui:define name="content">
                <f:event listener="#{clienteC.listar()}" type="preRenderView" />
                <h:form id="formEncabezado">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value="Nuevo" icon="pi pi-plus" 
                                             update=":formNuevoCliente" oncomplete="PF('dialogNuevoCliente').show()"
                                             styleClass="ui-button-success" style="margin-right: .5rem"
                                             actionListener="#{clienteC.limpiar()}" >
                                <p:resetInput target=":formNuevoCliente"/>
                            </p:commandButton>
                        </p:toolbarGroup>
                        
                        <p:toolbarGroup align="center">
                            <div class="products-table-header">
                                <span style="font-weight: bold">CLIENTES</span>
                            </div>
                        </p:toolbarGroup>

                        <p:toolbarGroup align="right">
                            <p:commandButton value=" XLS " icon="pi pi-download" styleClass="ui-button-help" ajax="false"
                                             style="float:right; background-color: yellowgreen; margin-right:10px">
                                <p:dataExporter type="xls" target=":formMostrarCliente:tablaCliente" fileName="cliente"/>
                            </p:commandButton>

                            <p:commandButton value="Reporte" styleClass="" ajax="false"
                                             style="float:right; background-color: #90CAF9" actionListener="#{clienteC.reportePersona()}"
                                             onclick="this.form.target = '_blank'" title="Relacion de Clientes "
                                             icon="pi pi-download"/>
                        </p:toolbarGroup>
                    </p:toolbar>
                </h:form>



                
                
                <h:form id="formMostrarCliente">

                    <p:dataTable id="tablaCliente" widgetVar="dtCliente" var="cliente" value="#{clienteC.listaCliente}"
                                 reflow="true" styleClass="products-table" rowKey="#{cliente.IDCLI}"
                                 paginator="true" rows="10" selectionMode="single"
                                 paginatorPosition="bottom" selection="#{clienteC.cliente}"
                                 emptyMessage="No hay datos de cliente">

                        <f:facet name="header">
                            <div class="products-table-header2">
                                <p:selectOneMenu value="#{clienteC.cass}" styleClass="estado">
                                    <f:selectItem noSelectionOption="true" itemLabel="Todos" itemValue="3"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Activos" itemValue="1"/>
                                    <f:selectItem noSelectionOption="true" itemLabel="Inactivos" itemValue="2">
                                    </f:selectItem>
                                    <p:ajax listener="#{clienteC.listar()}" update="formMostrarCliente"/>
                                </p:selectOneMenu>
                            </div>
                        </f:facet>

                        <p:column headerText="Codigo">
                            <h:outputText value="#{cliente.IDCLI}"/>
                        </p:column>
                        <p:column headerText="Nombre" filterBy="#{cliente.NOMCLI}">
                            <h:outputText value="#{cliente.NOMCLI}"/>
                        </p:column>
                        <p:column headerText="Apellido"  filterBy="#{cliente.APECLI}" >
                            <h:outputText value="#{cliente.APECLI}"/>
                        </p:column>
                        <p:column headerText="Celular" filterBy="#{cliente.CELCLI}">
                            <h:outputText value="#{cliente.CELCLI}"/>
                        </p:column>
                        <p:column headerText="Correo" >
                            <h:outputText value="#{cliente.CORCLI}"/>
                        </p:column>

                        <p:column exportable="false">
                            <p:commandButton icon="pi pi-pencil" update=":formEditarCliente"
                                             oncomplete="PF('dialogModificarCliente').show()"
                                             styleClass="edit-button rounded-button ui-button-success">
                                <f:setPropertyActionListener value="#{cliente}" target="#{clienteC.cliente}"/>
                                <p:resetInput target=":formEditarCliente"/>
                            </p:commandButton>
                            <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" 
                                             oncomplete="PF('deleteProductDialog').show()"
                                             update=":formMostrarCliente:tablaCliente">
                                <f:setPropertyActionListener value="#{cliente}" target="#{clienteC.cliente}"/>
                            </p:commandButton>
                        </p:column>
                        
                    </p:dataTable>
                    
                    <p:contextMenu for="tablaCliente" id="contextPrueba">
                        <p:menuitem value="Editar" oncomplete="PF('dialogModificarCliente').show()"
                                    icon="pi pi-save" update=":formEditarCliente"
                                    rendered="#{!clienteC.estadoInactivo}">
                            <p:resetInput target=":formEditarCliente"/>
                        </p:menuitem>
                        
                        <p:menuitem value="Eliminar" icon="pi pi-refresh" 
                                    oncomplete="PF('deleteProductDialog').show()"
                                    update=":formMostrarCliente:tablaCliente"
                                    rendered="#{!clienteC.estadoInactivo}">
                        </p:menuitem>
                        
                        <p:menuitem value="Restaurar" icon="=pi pi-search" actionListener="#{clienteC.restaurarCliente()}"
                                    update="formMostrarCliente:tablaCliente" rendered="#{clienteC.estadoInactivo}">
                            <p:confirm header="Confirmación" message="¿Deseas restaurar?" icon="pi pi-search"/>
                        </p:menuitem>
                    </p:contextMenu>
                    
                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                    </p:confirmDialog>

                </h:form>


                
                
                
                <p:dialog id="dlgEditCliente" header="Cliente Detalles" showEffect="fade" modal="true"
                          widgetVar="dialogModificarCliente" responsive="true" >
                    <h:form id="formEditarCliente">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombres" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{clienteC.cliente.NOMCLI}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgNOMCLI" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Ingrese el Nombre" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMCLI" for="nombre"/>

                            <p:outputLabel value ="Apellido" style="font-weight:bold; font-size:16px" />
                            <p:inputText value="#{clienteC.cliente.APECLI}" required="true" id="apellido">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgAPECLI" event="keyup" delay="800"/>
                                <p:tooltip for="apellido" value="Ingrese el Apellido" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgAPECLI" for="apellido"/>

                            <p:outputLabel value ="celular" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{clienteC.cliente.CELCLI}" required="true" id="celular" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="celularV"/>
                                <f:attribute name="telefono" value="#{clienteC.cliente.CELCLI}" />
                                <p:ajax update="msgTELCLI" event="keyup" delay="800"/>
                                <p:tooltip for="celular" value="Ingrese el TELEFONO" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgTELCLI" for="celular"/>

                            <p:outputLabel value ="correo" style="font-weight:bold; font-size:16px" />
                            <p:inputText id="EMACLI" value="#{clienteC.cliente.CORCLI}" maxlength="50">
                                <f:validator validatorId="emailV"/>
                                <f:attribute name="ids" value="#{clienteC.cliente.IDCLI}" />
                                <f:attribute name="tipo" value="CLIENTE" />
                                <p:ajax update="msgEMACLI" event="keyup" delay="800"/>
                                <p:tooltip for="EMACLI" value="Ingrese el EMAIL" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgEMACLI" for="EMACLI"/> 
                                         
                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{clienteC.modificarCliente()}"
                                             update=":formMostrarCliente:tablaCliente" 
                                             id="btnModificar"  value="Modificar"
                                             oncomplete="if(!args.validationFailed)PF('dialogModificarCliente').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogModificarCliente').hide()"
                                             class="ui-button-secondary"/>
                            
                        </p:panelGrid>
                    </h:form>
                </p:dialog>

                
                
                
                
                <p:dialog id="dlgNuevoCliente" header="Nuevo Cliente" showEffect="fade" modal="true"
                          widgetVar="dialogNuevoCliente" responsive="true" >
                    <h:form id="formNuevoCliente">
                        <p:panelGrid columns="3" styleClass="ui-noborder" >

                            <p:outputLabel value ="Nombres" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{clienteC.cliente.NOMCLI}" required="true" id="nombre">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgNOMCLI" event="keyup" delay="800"/>
                                <p:tooltip for="nombre" value="Ingrese el Nombre" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgNOMCLI" for="nombre"/>

                            <p:outputLabel value ="Apellido" style="font-weight:bold; font-size:16px" />
                            <p:inputText value="#{clienteC.cliente.APECLI}" required="true" id="apellido">
                                <f:validateLength minimum="2" maximum="50"/>
                                <p:keyFilter regEx="/[ABCDEFGHIJKLMNÑOPQRSTUVWXYZ]/i"/> 
                                <p:ajax update="msgAPECLI" event="keyup" delay="800"/>
                                <p:tooltip for="apellido" value="Ingrese el Apellido" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgAPECLI" for="apellido"/>

                            <p:outputLabel value ="celular" style="font-weight:bold; font-size:16px" />
                            <p:inputText value ="#{clienteC.cliente.CELCLI}" required="true" id="celular" maxlength="9">
                                <f:validateLength minimum="" maximum="9"/>
                                <p:keyFilter regEx="/[0-9]/i"/> 
                                <f:validator validatorId="celularV"/>
                                <f:attribute name="telefono" value="#{clienteC.cliente.CELCLI}" />
                                <p:ajax update="msgTELCLI" event="keyup" delay="800"/>
                                <p:tooltip for="celular" value="Ingrese el TELEFONO" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgTELCLI" for="celular"/>

                            <p:outputLabel value ="correo" style="font-weight:bold; font-size:16px" />
                            <p:inputText id="EMACLI" value="#{clienteC.cliente.CORCLI}" maxlength="50">
                                <f:validator validatorId="emailV"/>
                                <f:attribute name="ids" value="#{clienteC.cliente.IDCLI}" />
                                <f:attribute name="tipo" value="CLIENTE" />
                                <p:ajax update="msgEMACLI" event="keyup" delay="800"/>
                                <p:tooltip for="EMACLI" value="Ingrese el EMAIL" trackMouse="focus"/>
                            </p:inputText>
                            <p:message id="msgEMACLI" for="EMACLI"/> 

                            <p:commandButton icon="pi pi-check"
                                             actionListener="#{clienteC.nuevoCliente()}"
                                             update=":formMostrarCliente:tablaCliente" 
                                             id="btnModificar"  value="Agregar"
                                             oncomplete="if(!args.validationFailed)PF('dialogNuevoCliente').hide()"/>
                            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogNuevoCliente').hide()"
                                             class="ui-button-secondary"/>

                        </p:panelGrid>
                    </h:form>
                </p:dialog>

                
                

                
                <p:confirmDialog widgetVar="deleteProductDialog" showEffect="fade" width="300"
                                 message="Delete the product?" header="Confirm" severity="warn">
                    <p:commandButton value="Yes" icon="pi pi-check" actionListener="#{clienteC.eliminarCliente()}"
                                     process="@this" oncomplete="PF('deleteProductDialog').hide()" 
                                     update=":formMostrarCliente:tablaCliente"/>
                    <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times"
                                     onclick="PF('deleteProductDialog').hide()" 
                                     update=":formMostrarCliente:tablaCliente"/>
                </p:confirmDialog>






            </ui:define>
        </ui:composition>
    </h:body>
</html>
